
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="author" content="Maksym Grebenets" />
    <title>Mobile CI - OCLint</title>

    <link rel="stylesheet" href="/assets/themes/dinky/css/styles.css">
    <link rel="stylesheet" href="/assets/themes/dinky/css/pygment_trac.css">
    <script src="/assets/themes/dinky/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="/">NSBogan</a></h1>
        <p class="header">mobile ios android xcode automation calabash cucumber</p>
        <ul>
          
          
          


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



        </ul>
        
        
        <div class="misc vcard">
          <h4>about</h4>
          <ul>
            
            <li class="contact"><address><span class="author fn n">Maksym Grebenets</span> - <span class="fn email">mgrebenets@gmail.com</span></address></li>
            
            
            <li class="github"><a href="http://github.com/mgrebenets/" rel="me">github.com/mgrebenets</a></li>
            
            
            <li class="twitter"><a href="http://twitter.com/mgrebenets/" rel="me">twitter.com/mgrebenets</a></li>
            
            
            
            
            
          </ul>
        </div><!-- misc -->
        
      </header>

      <section>
      
<section>
  <h1>Mobile CI - OCLint</h1>

  
<p><a href="http://oclint.org/">OCLint</a> is a fantastic static code analysis tool for improving quality and reducing defects by inspecting C, C++ and Objective-C code.</p>

<!--more-->

<p>I’m not going to copy-paste the rest of oclint.org here, check it out to see what the tool can do. In this article you will learn how to set it up and use for Mobile CI.</p>

<p>OCLint is often referred as a <a href="http://en.wikipedia.org/wiki/Lint_%28software%29">lint</a> tool, but in the end of the day it’s a static analysis tool, meaning it analyses your code statically, that is without running it.</p>

<h2 id="install">Install</h2>

<p>For quite a while I though OCLint wasn’t available via <a href="http://brew.sh/">Homebrew</a> package manager. While it technically isn’t there yet, but it’s supported by <a href="http://caskroom.io/">Homebrew Cask</a>. If you never used it yet Homebrew Cask is an extension for Homebrew and lets you to manage OS X application just like packages. Another benefit of this tool is that it includes pure packages like oclint which are not yet available in Homebrew.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew install caskroom/cask/brew-cask</code></pre></div>

<p>Now install OCLint</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew cask install oclint</code></pre></div>

<p>Check the installation, it’s now sitting in <code>usr/local/</code>.</p>

<h2 id="use">Use</h2>

<p>I will write about using OCLint with <code>xcodebuild</code>, basically rewording <a href="http://docs.oclint.org/en/dev/guide/xcodebuild.html">official documentation</a>. OCLint supports all other tools, check out <a href="http://docs.oclint.org/en/dev/index.html#usage">documentation for details</a>.</p>

<p>Using OCLint with <code>xcodebuild</code> requires 3 steps.</p>

<ul>
  <li>Build and capture output.</li>
  <li>Generate compile commands database (JSON format) for OCLint using <code>xcodebuild</code> output.</li>
  <li>Run OCLint using generated JSON database.</li>
</ul>

<p>The first step is straightforward, run <code>xcodebuild</code> the way you would run it normally, the only difference is that you want to capture build output. Use <code>tee</code> command to do that, for example</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">xcodebuild clean build -project MyProject -scheme MyScheme -configuration Debug <span class="p">|</span> tee xcodebuild.log</code></pre></div>

<p>It is recommended to used Debug configuration for static analysis.</p>

<p>Next generate compilation commands database with <code>oclint-xcodebuild</code> command. This command expects a file named <code>xcodebuild.log</code> by default but in the example I will pass it explicitly. The default output file name is <code>compile_commands.json</code> but I’ll be verbose this time anyway.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">oclint-xcodebuild -output compile_commands.json xcodebuild.log</code></pre></div>

<p>Optionally you can use <code>-e | -exclude</code> file and pass regular expression which will exclude the files you are not interested in, such as 3rd party source code.</p>

<p>Finally, use <code>oclint-json-compilation-database</code> to run oclint and generate report.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">oclint-json-compilation-database <span class="se">\</span>
  <span class="k">${</span><span class="nv">LINT_EXCLUDES</span><span class="k">}</span> <span class="se">\</span>
  -- <span class="se">\</span>
  -report-type <span class="k">${</span><span class="nv">LINT_REPORT_TYPE</span><span class="k">}</span> <span class="se">\</span>
  <span class="k">${</span><span class="nv">LINT_RULES</span><span class="k">}</span> <span class="se">\</span>
  <span class="k">${</span><span class="nv">LINT_DISABLE_RULES</span><span class="k">}</span> <span class="se">\</span>
  <span class="k">${</span><span class="nv">LINT_THRESHOLD</span><span class="k">}</span> <span class="se">\</span>
  -o <span class="k">${</span><span class="nv">LINT_REPORTS_DIR</span><span class="k">}</span>/<span class="k">${</span><span class="nv">LINT_REPORT_FILE</span><span class="k">}</span> <span class="se">\</span>
  -stats <span class="se">\</span>
  -verbose <span class="se">\</span>
  -list-enabled-rules</code></pre></div>

<p>Let’s analyse this call in details and expand actual values of all environment variables.</p>

<p>First you call <code>oclint-json-compilation-database</code> and specify it’s own arguments. In this case it is a list of excludes passed as <code>${LINT_EXCLUDES}</code>. Each folder you want to exclude should be passed with it’s own <code>-e</code> flag, for example</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">LINT_EXCLUDES</span> <span class="o">=</span> -e Libraries -e lib</code></pre></div>

<p>The <code>-i [INCLUDES]</code> option is used to do the opposite to exclude.</p>

<p>The double dash <code>--</code> indicates the start of arguments which will be passed to invocation of <code>oclint</code> command.</p>

<p><strong>Report type</strong> specified via <code>-report-type</code> can be one of <code>text</code>, <code>html</code>, <code>xml</code>, <code>json</code> and <code>pmd</code>. For CI tasks you should definitely use (PMD)[http://en.wikipedia.org/wiki/PMD_%28software%29] report type. While running locally stick with <code>html</code>. So you should set <code>LINT_REPORT_TYPE</code> to one of these values. Read the <a href="http://docs.oclint.org/en/dev/customizing/reports.html">full documentation</a> for more.</p>

<p><strong>Lint rules</strong> is an option with which you can override default threshold values for rules. For example, Objective-C is very verbose language, so let’s increase thresholds for the the max length of line of code, name of method and name of variable. This is how it will look in shell script</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Rules</span>
<span class="nv">LINT_LONG_LINE</span><span class="o">=</span>300
<span class="nv">LINT_LONG_VARIABLE_NAME</span><span class="o">=</span>64
<span class="nv">LINT_LONG_METHOD</span><span class="o">=</span>150

<span class="nv">LINT_RULES</span><span class="o">=</span><span class="s2">&quot;-rc LONG_LINE=${LINT_LONG_LINE} \</span>
<span class="s2">      -rc LONG_VARIABLE_NAME=${LINT_LONG_VARIABLE_NAME} \</span>
<span class="s2">      -rc LONG_METHOD=${LINT_LONG_METHOD}&quot;</span></code></pre></div>

<p>You may want to disable some rules as well. This could be useful when working with some legacy code which smells a lot and there are no plans to fix it ever. In cases like this it’s easier to silent some warnings. For example, let’s disable warning about the use of <code>_ivarName</code> outside of accessors and initializers. Let’s also ignroe useless parentheses and warnings about unused method parameters.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Disable rules</span>
<span class="nv">LINT_DISABLE_RULES</span><span class="o">=</span><span class="s2">&quot;-disable-rule=UnusedMethodParameter \</span>
<span class="s2">            -disable-rule=UselessParentheses \</span>
<span class="s2">            -disable-rule=IvarAssignmentOutsideAccessorsOrInit&quot;</span></code></pre></div>

<p><a href="http://docs.oclint.org/en/dev/rules/index.html">Full list of rules</a> for further reference.</p>

<p><strong>Threshold</strong> allows you to control when analysis passes or fails. There are 3 priorities (Priority 1, 2 and 3) and each comes with default thresholds (0, 10 and 20). You can use <code>-max-priority-&lt;N&gt;</code> command line option to customize priority <code>N</code> threshold. This is how you would change it to 0, 20 and 30 correspondingly</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Threshold</span>
<span class="nv">LINT_PRIORITY_1_THRESHOLD</span><span class="o">=</span>0
<span class="nv">LINT_PRIORITY_2_THRESHOLD</span><span class="o">=</span>20
<span class="nv">LINT_PRIORITY_3_THRESHOLD</span><span class="o">=</span>30
<span class="nv">LINT_THRESHOLD</span> <span class="o">=</span> <span class="s2">&quot;-max-priority-1=${LINT_PRIORITY_1_THRESHOLD} -max-priority-2=${LINT_PRIORITY_2_THRESHOLD} -max-priority-3=${LINT_PRIORITY_3_THRESHOLD}&quot;</span></code></pre></div>

<p><strong>Output</strong> can be specified via <code>-o</code> option. If you are using PMD report type, write out to XML file, for HTML report, write to HTML format. Better create a separate directory for reports, for example</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Reports</span>
<span class="nv">LINT_REPORTS_DIR</span><span class="o">=</span>oclint-reports
<span class="c"># use .html for HTML report type</span>
<span class="nv">LINT_REPORT_FILE</span><span class="o">=</span>oclint.xml

mkdir -p <span class="k">${</span><span class="nv">LINT_REPORTS_DIR</span><span class="k">}</span></code></pre></div>

<p>Finally add some verbosity with <code>-stats</code> to output statistics, <code>-list-enabled-rules</code> to eyeball the rules being used and <code>-verbose</code> for what it stands.</p>

<h2 id="summary">Summary</h2>

<p>Give it a go. You now have a very powerful tool in your tool belt. Figure out your custom project thresholds, integrate it as part of your project <a href="/2015/02/08/mobile-ci---makefiles">makefile</a>, run it as CI job and output reports using one of the plugins available.</p>


  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'mgrebenets'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</section>


      </section>

      <footer>
      <p><small>Hosted on <a href="http://pages.github.com/">GitHub Pages</a> using the <a href="https://github.com/sodabrew/theme-dinky">Dinky theme</a> for <a href="http://jekyllbootstrap.com/">Jekyll Bootstrap</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>

