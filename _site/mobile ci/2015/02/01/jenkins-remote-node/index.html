
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      
        Jenkins Remote Node - 
      
      NSBogan
    </title>
    <meta name="description" content="Setup and Configure Jenkins Remote Node">
    <meta name="author" content="Maksym Grebenets">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/themes/hooligan/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/hooligan/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

            <a class="brand" href="/">NSBogan</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="https://github.com/mgrebenets" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                
                <li>
                  <a href="https://twitter.com/mgrebenets" class="zocial twitter icon" target="_blank">
                    <span class="hidden-desktop">Twitter</span>
                  </a>
                </li>
                
                
                
                
                <li>
                  <a href="http://feeds.feedburner.com/mgrebenets@gmail.com" class="zocial rss icon" target="_blank">
                    <span class="hidden-desktop">FeedBurner</span>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          
<div class="page-header">
  <h1>
    Jenkins Remote Node 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    
<p>A guide for setting up a remote build node for Jenkins CI server.</p>

<!--more-->

<p>If you are up to a task to setup remote build node, that means that you already have a server or need to <a href="/2015/02/01/jenkins-ci-server-on-osx">install it first</a>.</p>

<p>A good place to start is <a href="https://wiki.jenkins-ci.org/display/JENKINS/Distributed+builds">Jenkins Wiki page</a> with detailed description of all available options.</p>

<p>I would recommend to do first time agent installation via Jenkins UI <code>Jenkins -&gt; Manage Jenkins -&gt; Manage Nodes</code>. Select an option to create node, configure node’s properties (make sure root directory exists) and you are almost good to go. The preferred way to launch and agent is via SSH.</p>

<p>If Jenkins Wiki is such a good reference, then why bother with the post? - I bet that’s exactly what you are asking.</p>

<p>Well, again, the main focus is Mobile CI and part of any decent CI is tests, unit tests in particular. With iOS those must run in iOS Simulator which is a GUI application, which means you are facing <a href="/2015/02/01/mobile-ci-daemon-vs-agent">Deamon vs Agent</a> issue. Here’s a very good <a href="http://stackoverflow.com/questions/25380365/timeout-when-running-xcodebuild-tests-under-xcode-6-via-ssh">discussion on StackOverflow</a>.</p>

<p>So remote node launched via SSH is running as Launch Daemon and has no context to run GUI applications. If SSH session is running under non-login user, <code>xcodebuild test</code> will fail with error code <code>139</code> or alike. Running SSH session under login user will not help either, at best the simulator will but tests will never start. That rules out an option of running remote node via SSH. Trying all the tricks like enabling development mode, updating user’s group and security settings, didn’t work for me, probably because that answer was actual for Xcode 5, but not 6.</p>

<p>Next option would be launching slave agent via Java Web Start. Option with clicking button in the browser should be ignored right away, it hardly qualifies as automated approach. Using <code>javaws</code> it a bit better though requires you to login to slave agent via GUI and then run the command and answer one prompt by clicking Run button. Finally, you can run it in a headless mode</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">java -jar slave.jar -jnlpUrl http://yourserver:8080/jenkins/computer/parasite/slave-agent.jnlp</code></pre></div>

<p>Now that’s better, this will start a slave agent that is capable of running GUI applications and thus running iOS unit tests in simulator. If you are puzzled where does <code>slave.jar</code> come from, the answer is that it is put there by Jenkins server when you created slave agent via UI. The <code>jnlpUrl</code> tells an agent where the server is. The order in which agent and server are fired up seems to be important. Server first, agent second, otherwise agent may fail to start. I had this issue while using GUI mode launch via <code>javaws</code> and yet to confirm if it’s true for headless mode. Still you have to start an agent manually if remote node machine reboots.</p>

<p>I have one solution to offer. It is not the best I can think of, but it’s the easiest and reasonably reliable to start with. You need to turn the headless slave launch command into a Launch Daemon. The Launch Agent will start at the time of user’s login, so make sure the machine is configured for automatic login.</p>

<p>Setting up Launch Agent should become a usual drill for you after you deal with Mac-based CI for a while. Create a plist file in <code>~/Library/LaunchAgents</code>, name it what you like, for example <code>org.jenkins-agent-a.plist</code> and put the following content in it.</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>/Shared/Users/Jenkins-Agent-A/log/jenkins-agent-a-out.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>/Shared/Users/Jenkins-Agent-A/log/jenkins-agent-a-err.log<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;true/&gt;</span>
  <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;string&gt;</span>org.jenkins-agent-a<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;array&gt;</span>
    <span class="nt">&lt;string&gt;</span>/usr/bin/java<span class="nt">&lt;/string&gt;</span>
    <span class="c">&lt;!--&lt;string&gt;-Djava.util.logging.config.file=/opt/hudson/slave/logging.properties&lt;/string&gt;--&gt;</span>
    <span class="nt">&lt;string&gt;</span>-Duser.home=/Users/Shared/Jenkins-Agent-A<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>-jar<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>/Users/Shared/Jenkins-Agent-A/slave.jar<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>-jnlpUrl<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string&gt;</span>http://yourserver:8080/jenkins/computer/parasite/slave-agent.jnlp<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;/array&gt;</span>
  <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;true/&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></div>

<p>The <code>/Shared/Users/Jenkins-Agent-A</code> is your agent’s home. You should have create one when setting up agent via server UI and <code>slave.jar</code> should be already located in this folder. Now if agent machine reboots and autologin is configured, the agent will go back online automatically. If the server reboots though, I’m not quite sure what happens, my assumption is that agent will stay alive and will keep trying to reconnect to server and finally they both happily reunite. I’m yet to test how exactly it works in reality.</p>

<p>One additional note. You can run a remote agent on localhost, which technically makes it not remote any more. This may be useful when for some reason Jenkins server is launched under non-login user session (Launch Daemon again) and you can’t use default master node to run unit tests.</p>

<p>That sums it up. To compare how things are in Bamboo universe <a href="/2015/02/01/bamboo-remote-agent">check out this post</a>.</p>

    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="/2015/02/01/jenkins-ci-server-on-osx" title="Jenkins CI Server on OSX">&larr; Previous</a>
      
        <a class="btn" href="/archive.html">Archive</a>
      
        <a class="btn next" href="/2015/02/01/mobile-ci--ios-simulator" title="Mobile CI & iOS Simulator">Next &rarr;</a>
      
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'mgrebenets'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <section>
      <h4>Published</h4>
      <div class="date"><span>01 February 2015</span></div>
    </section>
    
      <section>
        <h4>Category</h4>
        <span class="category">
          Mobile CI
        </span>
      </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#mobile-ref">mobile <span>2</span></a></li>
     
    	<li><a href="/tags.html#ci-ref">ci <span>2</span></a></li>
     
    	<li><a href="/tags.html#jenkins-ref">jenkins <span>2</span></a></li>
     
    	<li><a href="/tags.html#remote-ref">remote <span>1</span></a></li>
     
    	<li><a href="/tags.html#agent-ref">agent <span>1</span></a></li>
     
    	<li><a href="/tags.html#slave-ref">slave <span>1</span></a></li>
     
    	<li><a href="/tags.html#node-ref">node <span>1</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2015 Maksym Grebenets
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://github.com/dhulihan/hooligan" target="_blank">The Hooligan Theme</a>
        </p>
      </div>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    
  </body>
</html>

