
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      
        Share Xcode Schemes - 
      
      NSBogan
    </title>
    <meta name="description" content="Share Xcode Schemes for Build Server">
    <meta name="author" content="Maksym Grebenets">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/themes/hooligan/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/hooligan/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

            <a class="brand" href="/">NSBogan</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="https://github.com/mgrebenets" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                
                <li>
                  <a href="https://twitter.com/mgrebenets" class="zocial twitter icon" target="_blank">
                    <span class="hidden-desktop">Twitter</span>
                  </a>
                </li>
                
                
                
                
                <li>
                  <a href="http://feeds.feedburner.com/mgrebenets@gmail.com" class="zocial rss icon" target="_blank">
                    <span class="hidden-desktop">FeedBurner</span>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          
<div class="page-header">
  <h1>
    Share Xcode Schemes 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    
<p>So you are facing one of these Xcode errors where it tells you that there’s no such scheme? This post could help to explain why Xcode does it and how to solve this problem.</p>

<!--more-->

<h1 id="shared-vs-user-schemes">Shared vs User Schemes</h1>

<p>While setting up build server for iOS app I have faced this issue multitude of times. Xcode schemes can be either shared or not. By default schemes are not shared and are owned by a user that creates them.</p>

<p>Here’s how it looks in Xcode, note the last column with checkboxes.
<img src="/assets/images/schemes-list.png" alt="Manage Schemes" /></p>

<p>If you look inside <code>kartoteka-reloaded.xcodeproj</code> folder you will see how Xcode stores the schemes.
Here’s how it looks when <code>kartoteka-reloaded.xcscheme</code> is not shared</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">kartoteka-reloaded.xcodeproj/
├── project.pbxproj
├── project.xcworkspace
│   └── contents.xcworkspacedata
├── xcshareddata
│   └── xcschemes
└── xcuserdata
    └── grebenetsm.xcuserdatad
        └── xcschemes
            ├── kartoteka-reloaded.xcscheme
            └── xcschememanagement.plist</code></pre></div>

<p>Now let’s tick the “Shared” checkbox then list directory contents again</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">kartoteka-reloaded.xcodeproj/
├── project.pbxproj
├── project.xcworkspace
│   └── contents.xcworkspacedata
├── xcshareddata
│   └── xcschemes
│       └── kartoteka-reloaded.xcscheme
└── xcuserdata
    └── grebenetsm.xcuserdatad
        └── xcschemes
            └── xcschememanagement.plist</code></pre></div>

<p>Notice how the <code>kartoteka-reloaded.xcscheme</code> moved from user data folder to shared data folder. This is basically what makes scheme a shared one.</p>

<p>The general practice for Xcode projects <code>.gitignore</code> file is to ignore user data</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># .gitignore</span>
xcuserdata/
*.xcuserdatad</code></pre></div>

<p>So when you check out source code on a build box, there won’t be any user schemes inside <code>.xcodeproj</code> folder and <code>xcodebuild</code> won’t be able to see the schemes and will fail to build them.</p>

<h1 id="solution">Solution</h1>

<p>You can solve this problem either manually or automatically.</p>

<p>Of course you can just talk to devs and ask them to share the scheme. Done!
You can even do this change yourself and create pull request with changes.</p>

<p>But this approach will not work in some cases. For example, if you want to run UI automation tests with Calabash, the steps are</p>

<ul>
  <li>Duplicate existing Xcode target and name new test target with <code>-cal</code> suffix</li>
  <li>Add Calabash framework to test target</li>
  <li>Build <code>-cal</code> test target and run tests</li>
</ul>

<p>The first step is done with <code>calabash-ios setup</code> command. When new target is created a scheme is created for it as well. This is the default setting for all Xcode projects and in this post we’ll assume that’s the way you have it configured as well.</p>

<p>Now the tricky part, it doesn’t matter if original scheme was shared, the new <code>-cal</code> scheme will not be shared. That means you won’t be able to build it from command line.</p>

<p>Since it all happens on a build box as part of a build plan, you can’t push anything back to the repository, you have to find a way to make this new scheme shared right now.</p>

<p>The answer to your problems comes from Ruby world. In particular the <a href="https://rubygems.org/gems/xcodeproj">xcodeproj</a> Ruby gem. This is an incredibly handy library to work with Xcode projects and workspaces. You can do pretty much anything you need, create and modify targets and schemes, add new files to targets, modify build settings and other properties, and, of course, share schemes. By the way, <code>xcodeproj</code> is used by <a href="https://github.com/CocoaPods/Xcodeproj">CocoaPods</a> and that says a lot.</p>

<p>Go ahead and install the gem</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>sudo<span class="o">]</span> gem install xcodeproj</code></pre></div>

<p>Now create a simple Ruby file, name it whatever you want</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># share_schemes.rb</span>

<span class="nb">require</span> <span class="s1">&#39;xcodeproj&#39;</span>
<span class="n">xcproj</span> <span class="o">=</span> <span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Project</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;MyProject.xcodeproj&quot;</span><span class="p">)</span>
<span class="n">xcproj</span><span class="o">.</span><span class="n">recreate_user_schemes</span>
<span class="n">xcproj</span><span class="o">.</span><span class="n">save</span></code></pre></div>

<p>This is it! Put your Xcode project name in there, then run and the scheme will be shared.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">chmod +x share_schemes.rb
./share_schemes.rb</code></pre></div>

<h1 id="caveats">Caveats</h1>
<p>It sounds to good to be true, right?
There’s a number of situations where shaing a scheme via Ruby script will not work as expected.</p>

<p>If your Xcode project already has a shared scheme, then you will end up having one scheme from user’s data directory and another one form <code>xcshareddata</code>. Xcode IDE will pick up both and that’s the reason why you see same scheme twice with project name in parentheses.
<img src="/assets/images/duplicated-schemes-list.png" alt="Manage Schemes" /></p>

<p>That’s not very bad and doesn’t normally cause any problems. Until that moment of time when you modify one scheme and forget about another. The best way to avoid this problem is to share schemes from day 1, Xcode will not create user schemes then.</p>

<p>The real trouble begins if you didn’t have any shared schemes and the scheme that you want to recreate and share is linked to a test target. That’s the default configuration for unit tests. So the problem is that <code>xcodeproj</code> <a href="https://github.com/CocoaPods/Xcodeproj/issues/139">doesn’t recreate dependencies to test target</a>. If you run a <code>xcodebuild test</code> action you’ll be surprised to see it failing. Unfortunately there isn’t an easy workaround for this problem, so you’d better share those schemes manually and commit changes to source control system.</p>

<h1 id="summary">Summary</h1>

<p>Surely the Ruby script can be improved, you’d want to pass Xcode project name as an argument or even look it up automatically.</p>

<p>As usual, in Summary I just provide file listing with a solution ready to copy-paste. Here’s more advanced Ruby script for your use. You can just get the file directly if you’d like, <a href="https://github.com/mgrebenets/mgrebenets.github.io/blob/master/assets/scripts/share-schemes.rb">share-schemes.rb</a></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># share_schemes.rb</span>

<span class="nb">require</span> <span class="s1">&#39;optparse&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;ostruct&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;xcodeproj&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;colorize&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;fileutils&#39;</span>

<span class="c1"># Option parser</span>
<span class="k">class</span> <span class="nc">OptionParser</span>

    <span class="c1"># Parse options</span>
    <span class="c1"># @param [Array&lt;String&gt;] args command line args</span>
    <span class="c1"># @return [OpenStruct] parsed options</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span>
        <span class="n">options</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kp">nil</span>

        <span class="n">opt_parser</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>

            <span class="n">opts</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;Usage: </span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vg">$0</span><span class="p">)</span><span class="si">}</span><span class="s2"> [options]&quot;</span>

            <span class="n">opts</span><span class="o">.</span><span class="n">separator</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-p [PROJECT]&#39;</span><span class="p">,</span> <span class="s1">&#39;--project [PROJECT]&#39;</span><span class="p">,</span> <span class="s2">&quot;Xcode project path. Automatically look up if not provided.&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">project</span><span class="o">|</span>
                <span class="n">options</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
            <span class="k">end</span>

            <span class="n">opts</span><span class="o">.</span><span class="n">separator</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">separator</span><span class="p">(</span><span class="s2">&quot;Help:&quot;</span><span class="p">)</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">on_tail</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="s1">&#39;Display this help&#39;</span><span class="p">)</span> <span class="k">do</span>
                <span class="nb">puts</span> <span class="n">opts</span>
                <span class="nb">exit</span>
            <span class="k">end</span>

        <span class="k">end</span>

        <span class="n">opt_parser</span><span class="o">.</span><span class="n">parse!</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">options</span>
    <span class="k">end</span> <span class="c1"># parse()</span>
<span class="k">end</span>

<span class="n">options</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ARGV</span><span class="p">)</span>

<span class="c1"># Lookup for Xcode project other than Pods</span>
<span class="c1"># @return [String] name of Xcode project or nil if not found</span>
<span class="k">def</span> <span class="nf">lookup_project</span>
    <span class="nb">puts</span> <span class="s2">&quot;Looking for Xcode project...&quot;</span>
    <span class="c1"># list all .xcodeproj files except Pods</span>
    <span class="n">projects_list</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">end_with?</span> <span class="s2">&quot;.xcodeproj&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">f</span> <span class="o">!=</span> <span class="s2">&quot;Pods.xcodeproj&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">projects_list</span><span class="o">.</span><span class="n">empty?</span> <span class="p">?</span> <span class="kp">nil</span> <span class="p">:</span> <span class="n">projects_list</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span>

<span class="c1"># lookup if not specificed</span>
<span class="n">options</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">lookup_project</span> <span class="k">if</span> <span class="o">!</span><span class="n">options</span><span class="o">.</span><span class="n">project</span>
<span class="k">if</span> <span class="o">!</span><span class="n">options</span><span class="o">.</span><span class="n">project</span> <span class="k">then</span>
    <span class="nb">puts</span> <span class="s2">&quot;Error&quot;</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="n">underline</span> <span class="o">+</span> <span class="s2">&quot;: No Xcode projects found in the working folder&quot;</span>
    <span class="nb">exit</span> <span class="mi">1</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">&quot;Using project path: &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">options</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">green</span>

<span class="n">xcproj</span> <span class="o">=</span> <span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Project</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
<span class="n">xcproj</span><span class="o">.</span><span class="n">recreate_user_schemes</span>
<span class="n">xcproj</span><span class="o">.</span><span class="n">save</span></code></pre></div>

<p>Right, this is one of those cases where actual meaningful code is very small (just 4 lines), the rest is options parsing and error checking, but then it’s worth it in the end.</p>

<p>Finally run it</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">chmod +x share_schemes.rb
./share_schemes.rb -p <span class="s2">&quot;MyProject.xcodeproj&quot;</span></code></pre></div>

<h3 id="ps">P.S.</h3>
<p><a href="http://stackoverflow.com/questions/14368938/xcodebuild-says-does-not-contain-scheme">Related thread</a> on StackOverflow.</p>


    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="/android/2014/05/29/build-android-in-the-cloud" title="Build Android in the Cloud">&larr; Previous</a>
      
        <a class="btn" href="/archive.html">Archive</a>
      
        <a class="btn next" href="/atlassian/2014/05/30/atlassian-cli-homebrew" title="Install Atlassian CLI with Homebrew">Next &rarr;</a>
      
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'mgrebenets'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <section>
      <h4>Published</h4>
      <div class="date"><span>29 May 2014</span></div>
    </section>
    
      <section>
        <h4>Category</h4>
        <span class="category">
          Xcode
        </span>
      </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags.html#apple-ref">apple <span>5</span></a></li>
     
    	<li><a href="/tags.html#ios-ref">ios <span>5</span></a></li>
     
    	<li><a href="/tags.html#xcode-ref">xcode <span>3</span></a></li>
     
    	<li><a href="/tags.html#osx-ref">osx <span>4</span></a></li>
     
    	<li><a href="/tags.html#xcodeproj-ref">xcodeproj <span>1</span></a></li>
     
    	<li><a href="/tags.html#ruby-ref">ruby <span>1</span></a></li>
     
    	<li><a href="/tags.html#shell-ref">shell <span>1</span></a></li>
     
    	<li><a href="/tags.html#resign-ref">resign <span>1</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2015 Maksym Grebenets
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://github.com/dhulihan/hooligan" target="_blank">The Hooligan Theme</a>
        </p>
      </div>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    
  </body>
</html>

